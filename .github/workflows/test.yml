name: Docker

on:
  push:
    branches:
      - ci-test

  pull_request:


jobs:

  test:

    runs-on: ubuntu-latest
    if: github.event_name == 'push'

    steps:
      - uses: actions/checkout@v2

      - name: prepare
        run: |
          ./env-prepare

      - name: Django Template App test
        shell: 'script -q -e -c "bash {0}"'
        run: |
          ./init django
          cd ~/chembient/django
          docker-compose up -d
          ./django-manage-py migrate
          ./django-manage-py createsuperuser --username test --noinput --email test@test.org
          ./django-manage-py collectstatic
          docker-compose logs
          docker-compose down

      - name: Jupyter Template App test
        shell: 'script -q -e -c "bash {0}"'
        run: |
          ./init jupyter
          cd ~/chembient/jupyter
          docker-compose up -d
          ./jupyter --version
          docker-compose logs
          docker-compose down

      - name: RDKit Template App test
        shell: 'script -q -e -c "bash {0}"'
        run: |
          ./init rdkit
          cd ~/chembient/rdkit
          ./run script.py
          docker-compose logs
          docker-compose down







