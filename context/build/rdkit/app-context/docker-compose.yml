version: '3'

services:

  app:
    image: chembience/rdkit:${RDKIT_APP_VERSION}
    container_name: chembience-rdkit
    volumes:
      - ${RDKIT_APP_HOME}:/home/app
      - ${CHEMBIENCE_SPHERE}:/home/sphere
      - ${CHEMBIENCE_SHARE}:/share
    networks:
      - sphere
    environment:
      - CHEMBIENCE_UID
      - CHEMBIENCE_GID
      - CHEMBIENCE_DB_USER
      - CHEMBIENCE_DB_HOST
      - CHEMBIENCE_DB_PORT
      - CHEMBIENCE_DB_PASSWORD
    depends_on:
      - postgres
    entrypoint: ["/home/app/docker-entrypoint.sh"]
    command: ["python"]


  postgres:
    image: chembience/postgres-rdkit:${CHEMBIENCE_POSTGRES_RDKIT_VERSION}
    container_name: chembience-rdkit-db
    volumes:
      - rdkit_db_volume:/var/lib/postgresql
      - ${RDKIT_APP_HOME}/postgres-init.d:/docker-entrypoint-initdb.d
    #restart: always
    networks:
      - sphere
    environment:
      - POSTGRES_PASSWORD
      - CHEMBIENCE_POSTGRES_RDKIT_VERSION
      - CHEMBIENCE_DB_USER
      - CHEMBIENCE_DB_NAME
      - CHEMBIENCE_DB_PASSWORD


volumes:
  rdkit_db_volume:

networks:
  sphere:
